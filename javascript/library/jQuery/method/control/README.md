# 選択した要素の整理／拡張／分割

既存のDOM要素からセレクタで選択したものや、HTML断片を使って新しく用意した要素集合を、jQuery関数で再定義したいときにその対象を整理／拡張／分割する方法をまとめます。jQueryを扱っていく上で基礎となるメソッドばかりです。

ここではjQueryのセレクタで選択したり、作製したHTML断片を**ラップ集合**と呼びます。jQueryにラップされている要素の集合ということをイメージしてください。










## ラップ集合のサイズを判定する

ラップ集合は、配列に似た方法で扱えます。ラップされた要素の数をふくむ`length`プロパティは、JavaScriptの配列と同様に扱うことができます。

プロパティでなくjQueryのメソッドを使いたいとき、**size()メソッド**を利用します。これは`length`プロパティと同じ情報を返します。

```

$('#mugiwara-team').html('They are' + $('.mugiwara-member').size());

```

すべての`.mugiwara-member`にマッチして、その要素の数を返しています。


#### 「sizeメソッド」

size()
: ラップ集合の中にある要素の数を返す

パラメータ
: なし

戻り値
: 要素の数










## ラップ集合内の要素の取得

要素を直接参照して、生のJavaScriptの操作を実行するときのメソッドやその他の方法があります。





### インデックスを使った要素の取得

jQueryではラップ集合をJavaScriptの配列と同様に扱えるので、単純に配列のインデックスを使って位置を指定することで要素を取得できます。

```

var nami = $('.mugiwara-member')[2];

```

配列のインデックスではなくjQueryのメソッドを使いたい場合は、**get()メソッド**を利用します。


#### 「getメソッド」

get(index)
: ラップ集合のうちマッチした要素の１つまたはすべてを取得する。indexが空の場合は、ラップ集合のすべての要素がJavaScript配列として返される。indexが指定されていると、そのインデックスの要素を返す。

パラメータ index
: (Number) 返したい要素のインデックス。

戻り値
: １つのDOM要素か、DOM要素の配列。


```

var zoro = $('.mugiwara-member').get(1);

```

`get()`はパラメータに負のインデックスを指定できます。その場合はラップ集合の末尾からの相対位置になります。

get()メソッドは１つのDOM要素を返しますが、場合によっては要素そのものではなくjQueryらしく、特定の要素１つをふくむラップ集合を用意したいときがあります。それはセレクタフィルタに似た**eq()メソッド**を利用します。


#### 「eqメソッド」

eq(index)
: ラップ集合の中でインデックスされた要素を取得し、その要素だけをふくむ新しいラップ集合を返す。

パラメータ index
: (Number) 返したい１つの要素のインデックス。getと同じく負のインデックスを指定すると末尾からの順となる。

戻り値
: 1個または、0個の要素をふくむラップ集合


ラップ集合にある最初と最後の要素取得するのには、簡単におこなえるように**first()メソッド**と**last()メソッド**が用意されています。


#### 「firstメソッド」

first()
: ラップ集合の中で最初の要素を取得し、その要素だけをふくむ新しいラップ集合を返す。元の集合が空の場合は、返す集合も空。

パラメータ
: なし

戻り値
: 1個または、0個の要素をふくむラップ集合


#### 「lastメソッド」

last()
: ラップ集合の中で最後の要素を取得し、その要素だけをふくむ新しいラップ集合を返す。元の集合が空の場合は、返す集合も空。

パラメータ
: なし

戻り値
: 1個または、0個の要素をふくむラップ集合





### 配列の要素の全取得

ラップ集合の全ての要素をDOM要素のJavaScript配列として取得したい場合は、**toArray()**メソッドを使います。


#### 「toArrayメソッド」

toArray()
: ラップ集合をDOM要素の配列として返す

パラメータ
: なし

戻り値
: ラップ集合内のDOM要素をJavaScript配列にしたもの

```

var mugiwaraTeam = $('.mugiwara-member').toArray();
var zoro = mugiwaraTeam[1];

```





### 要素のインデックス判定

インデックスの要素を返す`get()`メソッドの反対の動きとして、**index()メソッド**はラップ集合の中で要素のインデックスを判定するのに使えます。


#### 「indexメソッド」

index(element)
: ラップ集合の中で、指定した要素の集合におけるインデックスを返す。なければ「-１」を返す。

パラメータ
: (Element / Selector) インデックスを知りたい要素への参照か、その要素を識別するためのセレクタ。諸略されると、ラップ集合の最初の要素をその兄弟の中から探す。

戻り値
: 渡された要素が、ラップ集合の中で見つかった位置のインデックス。見つからない場合は「-1」。

```

var zoro = $('#mugiwara-team').index('#zoro');
var nami = $('#nami').index();
// zoro = 1
// nami = 2

```

パラメータに指定した要素の、ラップ集合でのインデックスを知ることができ、`index()`のパラメータを省略することで、自分自身のインデックスを知ることができるので同じ値を取得するのに２通りの方法があります。









## ラップされた要素の管理

jQueryにはラップした要素集合を追加したり、フィルタをかけて集合を縮小したい場合の、ラップ集合の管理を実現するメソッドがあります。





### ラップ集合への要素の追加

既存のラップ集合に対して、要素を追加したい場合、例えば元の集合に対して何らかのメソッドを適用してから、要素を追加して処理を実行したいときに使えるのが、**add()メソッド**です。`add()`はセレクタをチェインすることで和集合をつくっていきます。`add()`の特性として重要なことは、**元のラップ集合に単純に追加するのではなく新しくラップした集合を作る**ことです。元の集合を破壊せずにメソッドをチェインさせるので、後で戻るためのバックアップが生まれているというところがとても有能です。


#### 「addメソッド」

add(expression, context)
: ラップ集合のコピーを作り、expressionとcontextで指定した要素を新しい集合に追加する。セレクタ／HTML／DOM／DOM配列を渡すことができる。

パラメータ expression
: (Selector / Element / Array) マッチした集合に何を追加するかを指定する。jQueryセレクタの場合はマッチした要素が集合に追加される。HTMLの場合は要素が作成され集合に追加される。DOM要素かDOM要素の配列の場合は、そのまま配列に追加される。

パラメータ context
: (Selector / Elemnt / Array / jQuery) expressionでマッチさせる要素に範囲を与えるためのコンテクストを指定する。`$()`関数に渡せるものと同じもの。

戻り値
: 元のラップ集合をコピーして、指定した要素を追加した集合を返す。





### ラップ集合からの要素の削除

ラップ集合への追加は` add()`メソッドでしたが、反対に要素を削除する場合は**not()メソッド**を使います。


#### notメソッド

add(expression)
: ラップ集合のコピーを作り、expressionで指定した要素を削除する。

パラメータ expression
: (Selector / Element / Array / Function) マッチした集合から何を削除するかを指定する。jQueryセレクタの場合はマッチした要素が集合から削除される。要素の参照か要素の配列の場合は、それらが削除される。関数の場合は、ラップ集合のそれぞれの要素を`this`として関数を処理し、呼び出しの結果`ture`が返された要素をラップ集合から削除する。

戻り値
: 元のラップ集合をコピーして、指定した要素を削除した集合を返す。

この`not()`を使うことで、マッチした要素を除外することができますが、マッチした要素以外を削除したい場合は、**filter()**メソッドを使います。


#### filterメソッド

filter(expression)
: ラップ集合のコピーを作り、expressionで指定した要素以外を削除する。

パラメータ expression
: (Selector / Element / Array / Function) マッチした集合から何を削除するかを指定する。jQueryセレクタの場合はマッチした要素以外が集合から削除される。要素の参照か要素の配列の場合は、それら以外が削除される。関数の場合は、ラップ集合のそれぞれの要素を`this`として関数を処理し、呼び出しの結果`false`が返された要素をラップ集合から削除する。

戻り値
: 元のラップ集合をコピーして、指定した要素以外を削除した集合を返す。





### ラップ集合のサブセット化

ラップ集合から、集合内の要素の位置によって切り取ったサブセットを取得したい時、**slice()メソッド**を使います。


#### sliceメソッド

slice(begin, end)
: マッチした集合内の部分を含む、新しいラップ集合をつくって返す。

パラメータ begin
: (Number) 戻り値となるスライスに含めたい最初の要素の、0を奇数とする位置。

パラメータ end
: (Number) 戻り値となるスライスに含めたくない最初の要素の、0を奇数とする位置。省略したらスライスは元の集合の最後まで含むラップ集合を返す。

戻り値
: 新しく一部を切り取り作成したラップ集合。

```
$('#mugiwara-team').slice(1,5); // ２番目から5番目まで
$('#mugiwara-team').slice(1,2); // ２番目のみ
$('#mugiwara-team').slice(5); // 6以降全部

```











































